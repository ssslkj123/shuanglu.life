<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>20240416_Python手搓Http服务器 | Shuanglu的博客</title>
    <meta property="og:title" content="20240416_Python手搓Http服务器 - Shuanglu的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-04-16T04:01:37&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-04-16T04:01:37&#43;08:00'>
        
    <meta name="Keywords" content="[Python 多线程 IO多路复用]">
    <meta name="description" content="20240416_Python手搓Http服务器">
        
    <meta name="author" content="Kid">
    <meta property="og:url" content="https://shuanglu.life/post/20240416_python%E6%89%8B%E6%90%93http%E6%9C%8D%E5%8A%A1%E5%99%A8/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
        <link rel="stylesheet" href='/css//css/copy-to-clipboard.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://shuanglu.life/">
                        Shuanglu的博客
                    </a>
                
                <p class="description">运维技术笔记：Kubernetes,Docker,容器,CloudNative等相关</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://shuanglu.life/">首页</a>
                    
                    <a  href="https://shuanglu.life/archives/" title="归档">归档</a>
                    
                    <a  href="https://shuanglu.life/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    

    <article class="post">
        <header>
            <h1 class="post-title">20240416_Python手搓Http服务器</h1>
        </header>
        <date class="post-meta meta-date">
            2024年4月16日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/Python'>Python</a></span>
            
            <span class="meta-category"><a href='/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B'>多线程</a></span>
            
            <span class="meta-category"><a href='/categories/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8'>IO多路复用</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">

            <h1 id="20240416_python手搓http服务器">20240416_python手搓http服务器</h1>
<p>最近看了有关阻塞、非阻塞、同步、异步、IO多路复用一些知识，所以想着手搓一个极简版本的Http服务器用来练手、以及巩固知识。</p>
<p>相关代码如下：</p>
<h2 id="一多线程版">一、多线程版</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">random</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">socket</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">threading</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#998;font-style:italic"># 定义一个自定义的返回页面，通过读取当前文件夹下的index.html来构造web页面的bytes字节流</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">page_response</span>() <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#0086b3">bytes</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>        <span style="color:#998;font-style:italic"># return b&#34;Hello_world&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        <span style="color:#998;font-style:italic"># 两种实现：</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        <span style="color:#998;font-style:italic"># 方法1：打开文件为bytes模式，并进行bytes内容的替换。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>        <span style="color:#998;font-style:italic"># with open(&#34;index.html&#34;,mode=&#34;rb&#34;) as file : # rb 含义  r-&gt;read   b-&gt;bytes</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>        <span style="color:#998;font-style:italic">#     content_bytes= file.read()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>        <span style="color:#998;font-style:italic">#     content_bytes:bytes = content_bytes</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>        <span style="color:#998;font-style:italic">#     random_num: int = random.randint(1, 100)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>        <span style="color:#998;font-style:italic">#     new_content = content_bytes.replace(b&#34;{{replace_tag}}&#34;,str(random_num).encode(&#34;utf-8&#34;))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>        <span style="color:#998;font-style:italic">#     return new_content</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>        <span style="color:#998;font-style:italic"># 方法2：打开文件为str模式。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#34;index.html&#34;</span>, mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;r&#34;</span>, encoding<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;utf-8&#34;</span>) <span style="color:#000;font-weight:bold">as</span> file:  <span style="color:#998;font-style:italic"># rb 含义  r-&gt;read ,指定编码模式为utf-8</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>            content <span style="color:#000;font-weight:bold">=</span> file<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>            content:<span style="color:#0086b3">str</span> <span style="color:#000;font-weight:bold">=</span> content
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>            <span style="color:#998;font-style:italic"># 产生一个随机数用于替换index.html当中的{{replace_tag}} 字段内容,  :int变量注解。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>            random_num:<span style="color:#0086b3">int</span> <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>randint(<span style="color:#099">1</span>,<span style="color:#099">100</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>            modified_content <span style="color:#000;font-weight:bold">=</span> content<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">&#34;{{replace_tag}}&#34;</span>, <span style="color:#0086b3">str</span>(random_num))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>            modified_content_bytes <span style="color:#000;font-weight:bold">=</span> modified_content<span style="color:#000;font-weight:bold">.</span>encode(<span style="color:#d14">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>            <span style="color:#000;font-weight:bold">return</span>  modified_content_bytes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">b</span><span style="color:#d14">&#34;File not found or unable to open the file.&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">page_header</span>(body:<span style="color:#0086b3">bytes</span>) <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#0086b3">bytes</span>  :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    response_header <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#d14">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span><span style="color:#d14"></span><span style="color:#d14">HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span><span style="color:#d14">Content-Type: text/html;charset=utf-8
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span><span style="color:#d14">Content-Length:</span><span style="color:#d14">{}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span><span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#0086b3">len</span>(body))<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">\r\n</span><span style="color:#d14">&#39;</span>)<span style="color:#000;font-weight:bold">.</span>encode()  <span style="color:#998;font-style:italic"># encode() 会转化称为字节流 byte</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>    <span style="color:#000;font-weight:bold">return</span> response_header
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">print_threadlist</span>():
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>        <span style="color:#998;font-style:italic"># 获取所有活动线程</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>        all_threads <span style="color:#000;font-weight:bold">=</span> threading<span style="color:#000;font-weight:bold">.</span>enumerate()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span>        <span style="color:#998;font-style:italic"># 提取线程名称和线程 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>        filtered_threads <span style="color:#000;font-weight:bold">=</span> [(thread<span style="color:#000;font-weight:bold">.</span>name, thread<span style="color:#000;font-weight:bold">.</span>ident) <span style="color:#000;font-weight:bold">for</span> thread <span style="color:#000;font-weight:bold">in</span> all_threads]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span>        <span style="color:#998;font-style:italic"># print(filtered_threads)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>        <span style="color:#998;font-style:italic"># 创建一个格式化的字符串，包含线程名称和线程 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span><span>        formatted_output <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;, &#34;</span><span style="color:#000;font-weight:bold">.</span>join(<span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14"> (</span><span style="color:#d14">{</span>thread_id<span style="color:#d14">}</span><span style="color:#d14">)&#34;</span> <span style="color:#000;font-weight:bold">for</span> name, thread_id <span style="color:#000;font-weight:bold">in</span> filtered_threads)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span><span>        <span style="color:#998;font-style:italic"># 输出所有线程的名称和 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;输出所有线程: </span><span style="color:#d14">{</span>formatted_output<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span><span>        time<span style="color:#000;font-weight:bold">.</span>sleep(<span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span><span><span style="color:#998;font-style:italic"># 该函数用于产生conn的子线程并拼接字符串返回给该TCP链接</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn1</span>(conn:socket<span style="color:#000;font-weight:bold">.</span>socket): <span style="color:#998;font-style:italic"># 这里fn1函数使用参数注解，用以描述conn，后续conn 能够对带出相关的函数出来。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span><span>        <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span><span>            <span style="color:#998;font-style:italic"># 拼装一个http协议的回复报文的字节序列，定义在连接处产生随机字符串，</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span><span>            response_byte <span style="color:#000;font-weight:bold">=</span> page_header(page_response()) <span style="color:#000;font-weight:bold">+</span> page_response()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span><span>            data <span style="color:#000;font-weight:bold">=</span> conn<span style="color:#000;font-weight:bold">.</span>recv(<span style="color:#099">4096</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#0086b3">type</span>(data),data)  <span style="color:#998;font-style:italic"># 打印由client发送过来的二进制数据字节bytes.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> data: <span style="color:#998;font-style:italic"># 当clinet侧进行了主动断开连接，则此时conn 主动关闭，该if条件用于判断客户端主动挥手动作。 该处的not data 体现了python的数据等效性原则。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span><span>                <span style="color:#0086b3">print</span>(conn<span style="color:#000;font-weight:bold">.</span>getpeername() <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;Bye~&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span><span>                conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span><span>            conn<span style="color:#000;font-weight:bold">.</span>send(response_byte)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span><span>            <span style="color:#0086b3">print</span>(response_byte)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span><span>            <span style="color:#998;font-style:italic"># conn.close()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span> <span style="color:#000;font-weight:bold">as</span> e :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68</span><span>        <span style="color:#0086b3">print</span>(e)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69</span><span>    <span style="color:#000;font-weight:bold">finally</span>: <span style="color:#998;font-style:italic"># 处理最终请求，最终一定conn需要关闭该连接。 使用try except finally 逻辑处理。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70</span><span>        conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72</span><span><span style="color:#998;font-style:italic"># 定义一个产生conn连接的函数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn2</span>(server:socket<span style="color:#000;font-weight:bold">.</span>socket):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74</span><span>    thread_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75</span><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76</span><span>        conn, raddr <span style="color:#000;font-weight:bold">=</span> server<span style="color:#000;font-weight:bold">.</span>accept()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;Success accept raddr: </span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(raddr))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78</span><span>        <span style="color:#998;font-style:italic">#  将产生conn连接的对象丢到fn1 函数当中进行处理。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79</span><span>        threading<span style="color:#000;font-weight:bold">.</span>Thread(target<span style="color:#000;font-weight:bold">=</span>fn1,name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;conn-</span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(thread_number),args<span style="color:#000;font-weight:bold">=</span>(conn,),daemon<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)<span style="color:#000;font-weight:bold">.</span>start() <span style="color:#998;font-style:italic"># daemon为True表示为该线程为非陪跑线程。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80</span><span>        thread_number <span style="color:#000;font-weight:bold">+=</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82</span><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83</span><span>    <span style="color:#998;font-style:italic"># 定义一个Server</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84</span><span>    server <span style="color:#000;font-weight:bold">=</span> socket<span style="color:#000;font-weight:bold">.</span>socket()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85</span><span>    server<span style="color:#000;font-weight:bold">.</span>bind((<span style="color:#d14">&#34;0.0.0.0&#34;</span>,<span style="color:#099">1234</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86</span><span>    server<span style="color:#000;font-weight:bold">.</span>listen(<span style="color:#099">1024</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88</span><span>    <span style="color:#998;font-style:italic"># 产生一线程执行fn2函数，该函数用于持续接待新的连接并将其放置到新的线程当中。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89</span><span>    threading<span style="color:#000;font-weight:bold">.</span>Thread(target<span style="color:#000;font-weight:bold">=</span>fn2, name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;accept_thread&#34;</span>, args<span style="color:#000;font-weight:bold">=</span>(server,))<span style="color:#000;font-weight:bold">.</span>start() <span style="color:#998;font-style:italic"># 这里是一个一直循环的陪跑线程。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91</span><span>    <span style="color:#998;font-style:italic"># 配置一个死循环打印与检测当前整个进程的子线程数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92</span><span>    print_threadlist()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94</span><span>    <span style="color:#998;font-style:italic"># while True:</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95</span><span>        <span style="color:#998;font-style:italic"># time.sleep(5)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96</span><span>        <span style="color:#998;font-style:italic"># print(&#34;当前线程状态：{}&#34;.format([t.name for t in threading.enumerate()]))# 元组当中取元素，集合推导式的写法,从列表当中获取名字,如果加了*表示对齐解构，获得每一个元素。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97</span><span>    <span style="color:#998;font-style:italic"># server.close()</span>
</span></span></code></pre></div><h2 id="二线程池版">二、线程池版</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">random</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">socket</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">threading</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5</span><span><span style="color:#998;font-style:italic"># 引入线程池的包。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6</span><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">concurrent.futures</span> <span style="color:#000;font-weight:bold">import</span> ThreadPoolExecutor
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8</span><span><span style="color:#998;font-style:italic"># 构建一个模板，读取文件并返回</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9</span><span><span style="color:#998;font-style:italic"># respo_body=&#34;&#34;&#34;\</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10</span><span><span style="color:#998;font-style:italic"># &lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11</span><span><span style="color:#998;font-style:italic"># &lt;html lang=&#34;en&#34;&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12</span><span><span style="color:#998;font-style:italic"># &lt;head&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13</span><span><span style="color:#998;font-style:italic">#     &lt;meta charset=&#34;UTF-8&#34;&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14</span><span><span style="color:#998;font-style:italic">#     &lt;title&gt;我的主页&lt;/title&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15</span><span><span style="color:#998;font-style:italic"># &lt;/head&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16</span><span><span style="color:#998;font-style:italic"># &lt;body&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17</span><span><span style="color:#998;font-style:italic">#     &lt;h1 style=&#34;color:red&#34;&gt;测试，欢迎页面！Helloworld!!!-{}&lt;/h1&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18</span><span><span style="color:#998;font-style:italic"># &lt;/body&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19</span><span><span style="color:#998;font-style:italic"># &lt;/html&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20</span><span><span style="color:#998;font-style:italic"># &#34;&#34;&#34;.replace(&#34;{{}}&#34;,str(format(random.randint(0,100)))).encode()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24</span><span><span style="color:#998;font-style:italic"># 定义一个自定义的返回页面，通过读取当前文件夹下的index.html来构造web页面的bytes字节流</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">page_response</span>() <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#0086b3">bytes</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27</span><span>        <span style="color:#998;font-style:italic"># 两种实现：</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28</span><span>        <span style="color:#998;font-style:italic"># 方法1：打开文件为bytes模式，并进行bytes内容的替换。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29</span><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#34;index.html&#34;</span>, mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;rb&#34;</span>) <span style="color:#000;font-weight:bold">as</span> file:  <span style="color:#998;font-style:italic"># rb 含义  r-&gt;read   b-&gt;bytes</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30</span><span>            content_bytes <span style="color:#000;font-weight:bold">=</span> file<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31</span><span>            content_bytes: <span style="color:#0086b3">bytes</span> <span style="color:#000;font-weight:bold">=</span> content_bytes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32</span><span>            random_num: <span style="color:#0086b3">int</span> <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>randint(<span style="color:#099">1</span>, <span style="color:#099">100</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33</span><span>            new_content <span style="color:#000;font-weight:bold">=</span> content_bytes<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">b</span><span style="color:#d14">&#34;{{replace_tag}}&#34;</span>, <span style="color:#0086b3">str</span>(random_num)<span style="color:#000;font-weight:bold">.</span>encode(<span style="color:#d14">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34</span><span>            <span style="color:#000;font-weight:bold">return</span> new_content
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35</span><span>        <span style="color:#998;font-style:italic"># 方法2：打开文件为str模式。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36</span><span>        <span style="color:#998;font-style:italic"># with open(&#34;index.html&#34;, mode=&#34;r&#34;, encoding=&#34;utf-8&#34;) as file:  # rb 含义  r-&gt;read ,指定编码模式为utf-8</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37</span><span>        <span style="color:#998;font-style:italic">#     content = file.read()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38</span><span>        <span style="color:#998;font-style:italic">#     content:str = content</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39</span><span>        <span style="color:#998;font-style:italic">#     # 产生一个随机数用于替换index.html当中的{{replace_tag}} 字段内容,  :int变量注解。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40</span><span>        <span style="color:#998;font-style:italic">#     random_num:int = random.randint(1,100)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41</span><span>        <span style="color:#998;font-style:italic">#     modified_content = content.replace(&#34;{{replace_tag}}&#34;, str(random_num))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42</span><span>        <span style="color:#998;font-style:italic">#     modified_content_bytes = modified_content.encode(&#34;utf-8&#34;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43</span><span>        <span style="color:#998;font-style:italic">#     return  modified_content_bytes</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45</span><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">b</span><span style="color:#d14">&#34;File not found or unable to open the file.&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47</span><span><span style="color:#998;font-style:italic">#    Content-Type: text/html;charset=gbk</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">page_header</span>(body: <span style="color:#0086b3">bytes</span>) <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#0086b3">bytes</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49</span><span>    response_header <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#d14">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50</span><span><span style="color:#d14"></span><span style="color:#d14">HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51</span><span><span style="color:#d14">Content-Type: text/html;charset=utf-8
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52</span><span><span style="color:#d14">Content-Length:</span><span style="color:#d14">{}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53</span><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54</span><span><span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#0086b3">len</span>(body))<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>, <span style="color:#d14">&#39;</span><span style="color:#d14">\r\n</span><span style="color:#d14">&#39;</span>)<span style="color:#000;font-weight:bold">.</span>encode()  <span style="color:#998;font-style:italic"># encode() 会转化称为字节流 byte</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55</span><span>    <span style="color:#000;font-weight:bold">return</span> response_header
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">print_threadlist</span>():
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58</span><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59</span><span>        <span style="color:#998;font-style:italic"># 获取所有活动线程</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60</span><span>        all_threads <span style="color:#000;font-weight:bold">=</span> threading<span style="color:#000;font-weight:bold">.</span>enumerate()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61</span><span>        <span style="color:#998;font-style:italic"># 提取线程名称和线程 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62</span><span>        filtered_threads <span style="color:#000;font-weight:bold">=</span> [(thread<span style="color:#000;font-weight:bold">.</span>name, thread<span style="color:#000;font-weight:bold">.</span>ident) <span style="color:#000;font-weight:bold">for</span> thread <span style="color:#000;font-weight:bold">in</span> all_threads]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63</span><span>        <span style="color:#998;font-style:italic"># print(filtered_threads)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64</span><span>        <span style="color:#998;font-style:italic"># 创建一个格式化的字符串，包含线程名称和线程 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65</span><span>        formatted_output <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;, &#34;</span><span style="color:#000;font-weight:bold">.</span>join(<span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span>name<span style="color:#d14">}</span><span style="color:#d14"> (</span><span style="color:#d14">{</span>thread_id<span style="color:#d14">}</span><span style="color:#d14">)&#34;</span> <span style="color:#000;font-weight:bold">for</span> name, thread_id <span style="color:#000;font-weight:bold">in</span> filtered_threads)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66</span><span>        <span style="color:#998;font-style:italic"># 输出所有线程的名称和 ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;输出所有线程: </span><span style="color:#d14">{</span>formatted_output<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68</span><span>        time<span style="color:#000;font-weight:bold">.</span>sleep(<span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70</span><span><span style="color:#998;font-style:italic"># 该函数用于产生conn的子线程并拼接字符串返回给该TCP链接</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn1</span>(conn: socket<span style="color:#000;font-weight:bold">.</span>socket):  <span style="color:#998;font-style:italic"># 这里fn1函数使用参数注解，用以描述conn，后续conn 能够对带出相关的函数出来。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73</span><span>        <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74</span><span>            <span style="color:#998;font-style:italic"># 拼装一个http协议的回复报文的字节序列，定义在连接处产生随机字符串，</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75</span><span>            response_byte <span style="color:#000;font-weight:bold">=</span> page_header(page_response()) <span style="color:#000;font-weight:bold">+</span> page_response()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76</span><span>            data <span style="color:#000;font-weight:bold">=</span> conn<span style="color:#000;font-weight:bold">.</span>recv(<span style="color:#099">4096</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#0086b3">type</span>(data), data)  <span style="color:#998;font-style:italic"># 打印由client发送过来的二进制数据字节bytes.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78</span><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> data:  <span style="color:#998;font-style:italic"># 当clinet侧进行了主动断开连接，则此时conn 主动关闭，该if条件用于判断客户端主动挥手动作。 该处的not data 体现了python的数据等效性原则。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79</span><span>                <span style="color:#0086b3">print</span>(conn<span style="color:#000;font-weight:bold">.</span>getpeername() <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;Bye~&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80</span><span>                conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81</span><span>            conn<span style="color:#000;font-weight:bold">.</span>send(response_byte)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82</span><span>            <span style="color:#998;font-style:italic"># conn.close()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span> <span style="color:#000;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84</span><span>        <span style="color:#0086b3">print</span>(e)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85</span><span>    <span style="color:#000;font-weight:bold">finally</span>:  <span style="color:#998;font-style:italic"># 处理最终请求，最终一定conn需要关闭该连接。 使用try except finally 逻辑处理。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86</span><span>        conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88</span><span><span style="color:#998;font-style:italic"># 定义一个产生conn连接的函数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn2</span>(server: socket<span style="color:#000;font-weight:bold">.</span>socket):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90</span><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91</span><span>        conn, raddr <span style="color:#000;font-weight:bold">=</span> server<span style="color:#000;font-weight:bold">.</span>accept()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;Success accept raddr: </span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(raddr))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93</span><span>        <span style="color:#998;font-style:italic">#  调用fn1的函数，把fn1的函数丢到全局线程池thread_executor当中去执行，其中conn为fn1 函数的参数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94</span><span>        thread_executor<span style="color:#000;font-weight:bold">.</span>submit(fn1,conn)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96</span><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97</span><span>    <span style="color:#998;font-style:italic"># 定义一个Server</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98</span><span>    server <span style="color:#000;font-weight:bold">=</span> socket<span style="color:#000;font-weight:bold">.</span>socket()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99</span><span>    server<span style="color:#000;font-weight:bold">.</span>bind((<span style="color:#d14">&#34;0.0.0.0&#34;</span>, <span style="color:#099">1234</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100</span><span>    server<span style="color:#000;font-weight:bold">.</span>listen(<span style="color:#099">1024</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102</span><span>    <span style="color:#998;font-style:italic"># 使用线程池方式实现,多线程web页面。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103</span><span>    <span style="color:#998;font-style:italic"># 定义懒加载的全局线程池，容量为4个，这里不包括主线程，由于fn2为常驻状态，因此，client 最多能够同时连接3个进来。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104</span><span>    <span style="color:#998;font-style:italic"># 如果有第四个client连接进来，则会卡住，此时放入到队列当中，直到某个client退出后等待队列的线程才会正常处理网络请求。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105</span><span>    pool_size<span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106</span><span>    thread_executor <span style="color:#000;font-weight:bold">=</span> ThreadPoolExecutor(pool_size)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107</span><span>    <span style="color:#998;font-style:italic"># 把fn2的函数丢到线程池当中取执行。server为fn2的参数，这里不想 threading.Thread 使用元组传递参数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108</span><span>    thread_executor<span style="color:#000;font-weight:bold">.</span>submit(fn2,server)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110</span><span>    <span style="color:#998;font-style:italic"># 配置一个死循环打印与检测当前整个进程的子线程数。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111</span><span>    print_threadlist()
</span></span></code></pre></div><h2 id="三io多路复用版">三、IO多路复用版</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">socket</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2</span><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">selectors</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">page_response</span>():
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6</span><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#34;index.html&#34;</span>,mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;rb&#34;</span>) <span style="color:#000;font-weight:bold">as</span> file :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7</span><span>            content <span style="color:#000;font-weight:bold">=</span> file<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8</span><span>            <span style="color:#000;font-weight:bold">return</span>  content
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10</span><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">b</span><span style="color:#d14">&#34;File not found or unable to open the file.&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11</span><span><span style="color:#998;font-style:italic"># Content-Type: text/html;charset=gbk</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12</span><span>response_header <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#d14">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13</span><span><span style="color:#d14"></span><span style="color:#d14">HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14</span><span><span style="color:#d14">Content-Type: text/html;charset=utf-8
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15</span><span><span style="color:#d14">Content-Length:</span><span style="color:#d14">{}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16</span><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17</span><span><span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#0086b3">len</span>(page_response()))<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,<span style="color:#d14">&#39;</span><span style="color:#d14">\r\n</span><span style="color:#d14">&#39;</span>)<span style="color:#000;font-weight:bold">.</span>encode()  <span style="color:#998;font-style:italic"># encode() 会转化称为字节流 byte</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19</span><span><span style="color:#998;font-style:italic"># 拼装一个http协议的回复报文的字节流。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20</span><span>response_byte <span style="color:#000;font-weight:bold">=</span> response_header <span style="color:#000;font-weight:bold">+</span> page_response()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get_response</span>() <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#0086b3">bytes</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23</span><span>    <span style="color:#000;font-weight:bold">return</span>  response_byte
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn1</span>(server:socket<span style="color:#000;font-weight:bold">.</span>socket):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26</span><span>    conn,raddr <span style="color:#000;font-weight:bold">=</span> server<span style="color:#000;font-weight:bold">.</span>accept()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;type of conn :</span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#0086b3">type</span>(conn)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28</span><span>    <span style="color:#998;font-style:italic"># 需要将conn的阻塞状态也配置为一个非阻塞状态。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29</span><span>    conn<span style="color:#000;font-weight:bold">.</span>setblocking(<span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;conn是:</span><span style="color:#d14">{}</span><span style="color:#d14"> ， raddr是：</span><span style="color:#d14">{}</span><span style="color:#d14"> &#34;</span><span style="color:#000;font-weight:bold">.</span>format(conn,raddr))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31</span><span>    k<span style="color:#000;font-weight:bold">=</span>myselector<span style="color:#000;font-weight:bold">.</span>register(conn, selectors<span style="color:#000;font-weight:bold">.</span>EVENT_READ,fn2)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32</span><span>    <span style="color:#0086b3">print</span>(k)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33</span><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn2</span>(conn:socket<span style="color:#000;font-weight:bold">.</span>socket,raddr:<span style="color:#0086b3">tuple</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34</span><span>    <span style="color:#998;font-style:italic"># 配置该链接的超时时间 为10秒，如果没有数据过来则关闭</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35</span><span>    conn<span style="color:#000;font-weight:bold">.</span>settimeout(<span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36</span><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37</span><span>        <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38</span><span>            data <span style="color:#000;font-weight:bold">=</span> conn<span style="color:#000;font-weight:bold">.</span>recv(<span style="color:#099">1024</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;收到数据：&#34;</span>,data)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40</span><span>            conn<span style="color:#000;font-weight:bold">.</span>send(get_response())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;数据已经发&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42</span><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> data:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43</span><span>               <span style="color:#998;font-style:italic"># print(&#34;bye&#34;,conn.getpeername())</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44</span><span>               ip_address, port <span style="color:#000;font-weight:bold">=</span> raddr
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45</span><span>               <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;bye&#34;</span>,<span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span>ip_address<span style="color:#d14">}</span><span style="color:#d14">:</span><span style="color:#d14">{</span>port<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46</span><span>               myselector<span style="color:#000;font-weight:bold">.</span>unregister(conn)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47</span><span>               conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48</span><span>               <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49</span><span>    <span style="color:#000;font-weight:bold">except</span> socket<span style="color:#000;font-weight:bold">.</span>timeout:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;10 秒内没有接收到数据。正在关闭套接字。&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51</span><span>        myselector<span style="color:#000;font-weight:bold">.</span>unregister(conn)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52</span><span>        conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53</span><span>    <span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span> <span style="color:#000;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;发生错误：</span><span style="color:#d14">{</span>e<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55</span><span>        myselector<span style="color:#000;font-weight:bold">.</span>unregister(conn)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56</span><span>        conn<span style="color:#000;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57</span><span>    <span style="color:#000;font-weight:bold">finally</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58</span><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;Finally unregister and conn.close !&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59</span><span>        <span style="color:#998;font-style:italic"># 不能够直接关闭，关闭前需要反向注册Selector当中的连接。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61</span><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62</span><span>    server <span style="color:#000;font-weight:bold">=</span> socket<span style="color:#000;font-weight:bold">.</span>socket()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63</span><span>    server<span style="color:#000;font-weight:bold">.</span>bind((<span style="color:#d14">&#34;0.0.0.0&#34;</span>,<span style="color:#099">1234</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64</span><span>    server<span style="color:#000;font-weight:bold">.</span>setblocking(<span style="color:#000;font-weight:bold">False</span>) <span style="color:#998;font-style:italic"># 注意：如果使用 io 多路复用的模式则需要将server 设置为非阻塞状态。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65</span><span>    server<span style="color:#000;font-weight:bold">.</span>listen(<span style="color:#099">1024</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66</span><span>    <span style="color:#998;font-style:italic"># 打印输出server的类型，类型为socket.socket</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;type of server:</span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#0086b3">type</span>(server)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69</span><span>    <span style="color:#998;font-style:italic"># 实例化一个IO多路复用Selector</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70</span><span>    myselector <span style="color:#000;font-weight:bold">=</span> selectors<span style="color:#000;font-weight:bold">.</span>DefaultSelector()  <span style="color:#998;font-style:italic"># 实例化io多路复用类，其中python的多路复用会默认选择最佳的IO多路复用选择器，windows 只能够用Selector 模式。 linux 则会变为epoll模型。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72</span><span>    <span style="color:#998;font-style:italic"># 将server注册到 myselector当中，此外对于需要配置需要观测的事件，这里对于读事件进行关注,data字段是注册的执行函数，返回值为MySelectKey为注册的内容。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73</span><span>    <span style="color:#998;font-style:italic"># 查注册的IO多路复用器当中的内容：</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74</span><span>    MySelectKey <span style="color:#000;font-weight:bold">=</span> myselector<span style="color:#000;font-weight:bold">.</span>register(server,selectors<span style="color:#000;font-weight:bold">.</span>EVENT_READ<span style="color:#000;font-weight:bold">|</span> selectors<span style="color:#000;font-weight:bold">.</span>EVENT_WRITE,fn1)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey 全部内容:&#34;</span>, MySelectKey)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey 类型:&#34;</span>, <span style="color:#0086b3">type</span>(MySelectKey))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey.fileobj:&#34;</span>, MySelectKey<span style="color:#000;font-weight:bold">.</span>fileobj)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey.fileobj 类型:&#34;</span>, <span style="color:#0086b3">type</span>(MySelectKey<span style="color:#000;font-weight:bold">.</span>fileobj))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey.fd:&#34;</span>, MySelectKey<span style="color:#000;font-weight:bold">.</span>fd)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey.event:&#34;</span>, MySelectKey<span style="color:#000;font-weight:bold">.</span>events)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81</span><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;MySelectKey.data:&#34;</span>, MySelectKey<span style="color:#000;font-weight:bold">.</span>data)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83</span><span>    <span style="color:#998;font-style:italic"># 使用Selector 进行阻塞进程，等待进程进来。使用什么多路复用模型由python的default自己选择，返回元组由2个元素组成。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84</span><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span> : <span style="color:#998;font-style:italic"># 配置一个死循环，让IO多路复用器一直处于等待状态</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85</span><span>        <span style="color:#000;font-weight:bold">for</span> key,mask <span style="color:#000;font-weight:bold">in</span> myselector<span style="color:#000;font-weight:bold">.</span>select() :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key1:&#34;</span>,key)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;type key1:&#34;</span>,<span style="color:#0086b3">type</span>(key))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key1.fileobj:&#34;</span>,key<span style="color:#000;font-weight:bold">.</span>fileobj)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key1.fd:&#34;</span>, key<span style="color:#000;font-weight:bold">.</span>fd)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key1.event:&#34;</span>, key<span style="color:#000;font-weight:bold">.</span>events)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91</span><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key1.data:&#34;</span>, key<span style="color:#000;font-weight:bold">.</span>data)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92</span><span>            <span style="color:#998;font-style:italic"># 判断key.obj的类型进行分别传入两种参数，fn1传入1个对象，fn2 传入2个对象。</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93</span><span>            <span style="color:#000;font-weight:bold">if</span> key<span style="color:#000;font-weight:bold">.</span>data <span style="color:#000;font-weight:bold">==</span> fn1:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94</span><span>                key<span style="color:#000;font-weight:bold">.</span>data(key<span style="color:#000;font-weight:bold">.</span>fileobj)  <span style="color:#998;font-style:italic"># 单一入参： fn1(server:socket.socket)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95</span><span>            <span style="color:#000;font-weight:bold">if</span>  key<span style="color:#000;font-weight:bold">.</span>data <span style="color:#000;font-weight:bold">==</span> fn2:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96</span><span>                keyobj: socket<span style="color:#000;font-weight:bold">.</span>socket <span style="color:#000;font-weight:bold">=</span> key<span style="color:#000;font-weight:bold">.</span>fileobj
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97</span><span>                <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;key.fileobj.raddr:&#34;</span>, keyobj<span style="color:#000;font-weight:bold">.</span>getpeername() )
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98</span><span>                ip_address, port <span style="color:#000;font-weight:bold">=</span> keyobj<span style="color:#000;font-weight:bold">.</span>getpeername()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99</span><span>                <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;type of kobj.getpeername():&#34;</span>,<span style="color:#0086b3">type</span>(keyobj<span style="color:#000;font-weight:bold">.</span>getpeername()))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100</span><span>                <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;IP 地址: </span><span style="color:#d14">{</span>ip_address<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101</span><span>                <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;端口号: </span><span style="color:#d14">{</span>port<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102</span><span>                <span style="color:#998;font-style:italic"># key1.data(key1.fileobj)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103</span><span>                key<span style="color:#000;font-weight:bold">.</span>data(key<span style="color:#000;font-weight:bold">.</span>fileobj,keyobj<span style="color:#000;font-weight:bold">.</span>getpeername())  <span style="color:#998;font-style:italic"># fn2 2个参数入参 fn2(conn:socket.socket,raddr:tuple)</span>
</span></span></code></pre></div><h2 id="四html模板">四、html模板</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;<span style="color:#000080">html</span> <span style="color:#008080">lang</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>&lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">charset</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    &lt;<span style="color:#000080">title</span>&gt;我的主页&lt;/<span style="color:#000080">title</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>&lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>&lt;<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    &lt;<span style="color:#000080">h1</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;color:red&#34;</span>&gt;测试，欢迎页面！Helloworld!!!-{{replace_tag}}&lt;/<span style="color:#000080">h1</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>&lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre></div>

	    

<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://ssslkj123.github.io/css/gitalk.css">
<link rel="stylesheet" href="https://ssslkj123.github.io/css/gitalk/comment.css">

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://ssslkj123.github.io/js/md5.min.js"></script>
<script type="text/javascript">
      var gitalk = new Gitalk({
        clientID: '9bbccf93efbc67caca32',
        clientSecret: '208da9c1b3eccad0b7ca35b2faa27390e4982e64',
        repo: 'ssslkj123.github.io',
        owner: 'ssslkj123',
        admin: 'ssslkj123',
        id: md5(location.pathname), 
        distractionFreeMode: false 
      });
     (function() {
       if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
         document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
         return;
       }
       gitalk.render('gitalk-container');
     })();
</script>




        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://shuanglu.life/">Kid</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://shuanglu.life/post/20240416_python%E6%89%8B%E6%90%93http%E6%9C%8D%E5%8A%A1%E5%99%A8/">https://shuanglu.life/post/20240416_python%E6%89%8B%E6%90%93http%E6%9C%8D%E5%8A%A1%E5%99%A8/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>
<div style="padding: 10px 0; margin: 20px auto; width: 100%; font-size:16px; text-align: center;">
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
        <span>打赏</span></button>
    <div id="QR" style="display: none;">
        <div id="wechat" style="display: inline-block">
            <a class="fancybox" rel="group">
                <img id="wechat_qr" src="https://github.com/ssslkj123/shuanglu.life/blob/master/images/wx.png?raw=true" alt="WeChat Pay"></a>
            <p>微信打赏</p>
        </div>
        <div id="alipay" style="display: inline-block">
            <a class="fancybox" rel="group">
                <img id="alipay_qr" src="https://github.com/ssslkj123/shuanglu.life/blob/master/images/zfb.png?raw=true" alt="Alipay"></a>
            <p>支付宝打赏</p>
        </div>
    </div>
</div>



        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Python'>Python</a></li>
                
                <li><a href='/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B'>多线程</a></li>
                
                <li><a href='/tags/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8'>IO多路复用</a></li>
                
            </ul>
            
        </div>
    </article>
    
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://shuanglu.life/">Shuanglu的博客 By Kid</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        
    </div>
	
    <script src="/js/clipboard.js"></script>
	
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>


                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://shuanglu.life/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://shuanglu.life/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://shuanglu.life/post/20240516_SQL%E9%80%9F%E6%88%90/" title="20240516_速成SQL">20240516_速成SQL</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20240420_getopts%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BD%BF%E7%94%A8/" title="20240420_getopts脚本模板">20240420_getopts脚本模板</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20240416_python%E6%89%8B%E6%90%93http%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="20240416_Python手搓Http服务器">20240416_Python手搓Http服务器</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20240410_pod%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97IP%E5%9C%B0%E5%9D%80/" title="20240410_pod如何获取IP地址">20240410_pod如何获取IP地址</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20240206_github%E5%A4%A7%E6%96%87%E4%BB%B6commit/" title="20240206_github大文件commit">20240206_github大文件commit</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20240110_golang%E6%8E%92%E5%BA%8F/" title="20240110_golang排序">20240110_golang排序</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20230807_eci%E4%B8%8Eswagent%E9%97%AE%E9%A2%98%E5%A4%84%E7%BD%AE%E6%96%B9%E5%BC%8F/" title="20230807_eci与swagent问题处置方式">20230807_eci与swagent问题处置方式</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20230727_velero%E5%A4%87%E4%BB%BD%E8%BF%81%E7%A7%BBkubernetes%E9%9B%86%E7%BE%A4/" title="20230727_velero备份迁移kubernetes集群">20230727_velero备份迁移kubernetes集群</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20230309_KuriseRollout%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" title="20230309_KuriseRollout灰度发布">20230309_KuriseRollout灰度发布</a>
    </li>
    
    <li>
        <a href="https://shuanglu.life/post/20230113_docker.sock%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F/" title="20230113_docker.sock构建镜像">20230113_docker.sock构建镜像</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://shuanglu.life/categories/1.10&#43;/">1.10&#43; (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/CNI/">CNI (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/docker/">Docker (3)</a></li>
    
    <li><a href="https://shuanglu.life/categories/dockerfile/">Dockerfile (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/etcd/">Etcd (2)</a></li>
    
    <li><a href="https://shuanglu.life/categories/git/">Git (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/github/">Github (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/golang/">Golang (2)</a></li>
    
    <li><a href="https://shuanglu.life/categories/Harbor/">Harbor (2)</a></li>
    
    <li><a href="https://shuanglu.life/categories/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">IO多路复用 (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/KruiseRollout/">KruiseRollout (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/Kubernetes/">Kubernetes (6)</a></li>
    
    <li><a href="https://shuanglu.life/categories/Linux/">Linux (3)</a></li>
    
    <li><a href="https://shuanglu.life/categories/openkruise/">Openkruise (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/openssl/">Openssl (2)</a></li>
    
    <li><a href="https://shuanglu.life/categories/os/">Os (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/Python/">Python (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/shell/">Shell (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/SQL/">SQL (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/systemd/">Systemd (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/velero/">Velero (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/web/">Web (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程 (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/%E5%AE%B9%E5%99%A8%E5%9F%BA%E7%A1%80/">容器基础 (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/">容器网络 (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库 (1)</a></li>
    
    <li><a href="https://shuanglu.life/categories/%E6%A8%A1%E6%9D%BF/">模板 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://shuanglu.life/tags/CNI/">CNI</a>
    
    <a href="https://shuanglu.life/tags/docker/">Docker</a>
    
    <a href="https://shuanglu.life/tags/dockerfile/">Dockerfile</a>
    
    <a href="https://shuanglu.life/tags/etcd/">Etcd</a>
    
    <a href="https://shuanglu.life/tags/git/">Git</a>
    
    <a href="https://shuanglu.life/tags/github/">Github</a>
    
    <a href="https://shuanglu.life/tags/golang/">Golang</a>
    
    <a href="https://shuanglu.life/tags/Haproxy/">Haproxy</a>
    
    <a href="https://shuanglu.life/tags/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">IO多路复用</a>
    
    <a href="https://shuanglu.life/tags/k8s/">K8s</a>
    
    <a href="https://shuanglu.life/tags/KruiseRollout/">KruiseRollout</a>
    
    <a href="https://shuanglu.life/tags/Kubernete/">Kubernete</a>
    
    <a href="https://shuanglu.life/tags/Linux/">Linux</a>
    
    <a href="https://shuanglu.life/tags/nginx/">Nginx</a>
    
    <a href="https://shuanglu.life/tags/os/">Os</a>
    
    <a href="https://shuanglu.life/tags/Python/">Python</a>
    
    <a href="https://shuanglu.life/tags/shell/">Shell</a>
    
    <a href="https://shuanglu.life/tags/skywalking-swck-mutating-webhook-configuration/">Skywalking-Swck-Mutating-Webhook-Configuration</a>
    
    <a href="https://shuanglu.life/tags/SQL/">SQL</a>
    
    <a href="https://shuanglu.life/tags/velero/">Velero</a>
    
    <a href="https://shuanglu.life/tags/%E4%BC%98%E5%8C%96/">优化</a>
    
    <a href="https://shuanglu.life/tags/%E5%8D%87%E7%BA%A7%E9%94%99%E8%AF%AF/">升级错误</a>
    
    <a href="https://shuanglu.life/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a>
    
    <a href="https://shuanglu.life/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    
    <a href="https://shuanglu.life/tags/%E6%A8%A1%E6%9D%BF/">模板</a>
    
    <a href="https://shuanglu.life/tags/%E8%AF%81%E4%B9%A6/">证书</a>
    
    <a href="https://shuanglu.life/tags/%E8%BD%AC%E6%8D%A2/">转换</a>
    
    <a href="https://shuanglu.life/tags/%E9%80%9A%E7%94%A8%E7%9F%A5%E8%AF%86/">通用知识</a>
    
    <a href="https://shuanglu.life/tags/%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/">镜像仓库</a>
    
    <a href="https://shuanglu.life/tags/%E9%97%AE%E9%A2%98/">问题</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://shuanglu.live" title="Shuanglu的博客">Shuanglu的博客</a>
        </li>
        
        <li>
            <a target="_blank" href="http://docs.kubernetes.org.cn/" title="kubernetes相关指南">Kubernetes指南</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://shuanglu.life/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>